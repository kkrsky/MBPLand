<!--<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>-->
<script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
<script src="https://unpkg.com/vuex"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sass.js/0.9.12/sass.sync.min.js"></script>
<!-- vue component -->

<!-- vue-img-inputer https://www.kabanoki.net/6250/ -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/vue-img-inputer@2.1.6/dist/index.css"
/>
<script src="https://cdn.jsdelivr.net/npm/vue-img-inputer@2.1.6/dist/index.js"></script>

<script>
  // google.script.run.withSuccessHandler(initializeVue).getSpreadsheetName();

  initGlobal();
  initializeVue();

  var page1 = "<div>ページ１を表示</div>";
  var page2 = "<div>ページ２を表示</div>";
  var home = "<div>home</div>";
  var settings = "<div>settings</div>";
  var about = "<div>about</div>";
  var login = "<div>login</div>";
  var test = "<div>test</div>";
  function initGlobal() {
    //sass init
    Sass.compile(
      document.querySelector("style[type=scss]").innerHTML,
      function (res) {
        var s = document.createElement("style");
        s.innerHTML = res.text;
        res.formatted && console.error(res.formatted); //if error console.error it.
        res.text && document.head.appendChild(s); // append style element only if no error.
      }
    );

    //vue-img-inputer init
    const ImgInputer = window["vueImgInputer"];
    Vue.component("img-inputer", ImgInputer);
  }
  function gasFunc(method, prop) {
    return new Promise((resolve, reject) => {
      google.script.run
        .withSuccessHandler((result) => resolve(result))
        .withFailureHandler((error) => resolve(error))
        [method](prop);
    });
  }

  class FileReaderEx extends FileReader {
    //https://qiita.com/dojyorin/items/26f1a48085e0bbcf40b7
    constructor() {
      super();
    }

    #readAs(blob, ctx) {
      return new Promise((res, rej) => {
        super.addEventListener("load", ({ target }) => res(target.result));
        super.addEventListener("error", ({ target }) => rej(target.error));
        super[ctx](blob);
      });
    }

    readAsArrayBuffer(blob) {
      return this.#readAs(blob, "readAsArrayBuffer");
    }

    readAsDataURL(blob) {
      return this.#readAs(blob, "readAsDataURL");
    }

    readAsText(blob) {
      return this.#readAs(blob, "readAsText");
    }
  }

  async function initializeVue() {
    new Vue({
      el: "#app",
      vuetify: new Vuetify(),
      router: new VueRouter({
        mode: "history",
        // base:'/app/public/',
        routes: [
          {
            path: "/",
            component: {
              template: home,
            },
          },
          {
            path: "/test",
            component: {
              template: test,
            },
          },
          {
            path: "/settings",
            component: {
              template: settings,
            },
          },
          {
            path: "/about",
            component: {
              template: about,
            },
          },
          {
            path: "/login",
            component: {
              template: login,
            },
          },
          {
            path: "/page1",
            component: {
              template: page1,
            },
          },
          {
            path: "/page2",
            component: {
              template: page2,
            },
          },
        ],
      }),
      store: new Vuex.Store({
        modules: {
          snackbarState: {
            namespaced: true,
            state: () => ({
              isSnackbar: false,
              message: "tes",
              timeout: 3000,
            }),
            getters: {
              getSnackbarObj(state) {
                let obj = {
                  isSnackbar: state.isSnackbar,
                  message: state.message,
                  timeout: state.timeout,
                };
                return obj;
              },
              getIsSnackbar(state) {
                return state.isSnackbar;
              },
              getMessage(state) {
                return state.message;
              },
            },
            mutations: {},
            actions: {
              //APIs
              fire({ state, dispatch }, { message, timeout }) {
                message ? dispatch("setMessage", message) : null;
                timeout ? (state.timeout = timeout) : null;
                dispatch("setIsSnackbar", true);
              },
              //setter
              setIsSnackbar({ state }, bool) {
                state.isSnackbar = bool;
              },
              setMessage({ state }, msg) {
                state.message = msg;
              },
            },
          },
        },
      }),
      data: {
        deviceready: false,
        queryObj: {}, //自動挿入
        userObj: { userId: "Guest", name: "Guest" }, //自動挿入
        memberObj: {
          list: [
            { name: "A", userId: 1 },
            { name: "B", userId: 2 },
          ], //自動挿入
          selectMemberObj: [], //代理ログイン用,現在のユーザーが自動挿入
          subscribeMemberList: [], //自動挿入
        },
        paymentObj: {
          list: [{ label: "SUBSCRIBE", value: "SUBSCRIBE" }],
          selectPaymentObj: { label: "SUBSCRIBE", value: "SUBSCRIBE" },
          TYPE: {
            SUBSCRIBE: "SUBSCRIBE",
            ERROR: "ERROR",
          },
          requestUserIdArry: [], //請求するユーザーIDリスト
        },
        subscObj: {
          refName: "subscribe_form",
          database: {}, //自動挿入
          list: ["A", "B", "C", "その他", "追加"],
          writePriceType: ["１個当たりの値段", "合計金額"],
          ATTRIBUTE_LIST: {
            LISTED: "LISTED",
            ADD: "ADD",
            OTHER: "OTHER",
            ERROR: "ERROR",
          },

          //リスト情報
          selectItemArry: [], //selectItem_i
          selectItemPriceArry: [], //selectItem_i
          selectItemNumArry: [], //selectItem_i
          selectPriceTypeArry: [], //selectItem_i

          //追加情報
          listAddName: "[追加]",
          addItemNum: 0,
          addNameArry: [], //add_i
          addPriceArry: [], //add_i
          addNumArry: [], //add_i
          addPriceTypeArry: [], //add_i
          addIsShow: [], //add_i

          //その他情報
          listOtherName: "[その他]",
          otherItemNum: 0,
          otherNameArry: [], //other_i
          otherPriceArry: [], //other_i
          otherNumArry: [], //other_i
          otherPriceTypeArry: [], //other_i
          otherIsShow: [], //other_i

          memo: "", //投稿に対しての備考
          uploadFile: "",
        },
        validateRules: {
          required: (value) => !!value || "必ず入力してください", // 入力必須の制約
          number: (value) => !isNaN(Number(value)) || "数値を入力してください", // 入力必須の制約
          exceptZero: (value) => !(value == 0) || "0は入力できません。", // 入力必須の制約
        },
        loadingObj: {
          isLoading: false,
          message: "Loading...",
        },
        helper: {},
        submitObj: {
          template: {
            // deal_id:'', //自動挿入される
            createAt: "",
            deleteAt: "",
            updateAt: "",
            submitType: "DEFAULT",
            attribute: null,
            buyUserId: null,
            buyUserName: null,
            requestUserIdArry: [],
            name: null,
            num: null,
            price: null,
            sumPrice: null,
            memo: "",
            imageName: null,
            // imageUrl:''//自動挿入される
          },
          TYPE: {
            SUBSCRIBE: "SUBSCRIBE", //サブスク
            BUY: "BUY", //購入
            REQUEST: "REQUEST", //請求
            PAYMENT: "PAYMENT", //返金
            NOTICE: "NOTICE", //通知
            ERROR: "ERROR", //エラー
          },
        },
        leftMiniVariant: false,
        leftDrawer: false,
        rightDrawer: false,
        selectedItem: 1,
        userDataArryKey: [
          "createAt",
          "deleteAt",
          "name",
          "userId",
          "status",
          "iconUrl",
          "ZZZ",
        ],
        leftDrowerList: [
          {
            id: 0,
            text: "全体のお知らせ",
            icon: "mdi-newspaper",
            goto: "/",
            isShow: true,
          },
          {
            id: 1,
            text: "みんなのおかねのやりとり",
            icon: "mdi-credit-card-multiple",
            goto: "/",
            isShow: true,
          },
          {
            id: 2,
            text: "あなたのおかねのやりとり",
            icon: "mdi-credit-card",
            goto: "/",
            isShow: true,
          },
          {
            id: 3,
            text: "支払いリスト",
            icon: "mdi-export",
            goto: "/",
            isShow: true,
          },
          {
            id: 4,
            text: "請求リスト",
            icon: "mdi-import",
            goto: "/",
            isShow: true,
          },
          {
            id: 5,
            text: "請求を追加",
            icon: "mdi-import",
            goto: "/",
            isShow: true,
          },
          {
            id: 6,
            text: "設定",
            icon: "mdi-settings",
            goto: "settings",
            isShow: true,
          },
          {
            id: 7,
            text: "テスト",
            icon: "mdi-flag",
            goto: "test",
            isShow: true,
          },
          {
            id: 8,
            text: "テスト2",
            icon: "mdi-flag",
            goto: "test",
            isShow: true,
          },
        ],
      },
      created() {
        this.initCreated();
      },
      mounted() {
        window.setTimeout(() => {
          this.initDeviceready();
        }, 1000);
      },
      computed: {
        isSnackbar: {
          get() {
            return this.$store.getters["snackbarState/getIsSnackbar"];
          },
          set(bool) {
            this.$store.dispatch("snackbarState/setIsSnackbar", bool);
          },
        },
        snackbarObj: {
          get() {
            return this.$store.getters["snackbarState/getSnackbarObj"];
          },
          // set(val) {
          //   this.$store.dispatch("snackbarState/setMessage", val);
          // },
        },
      },
      methods: {
        //init
        async initCreated() {
          this.initQueryData(queryData);
          await this.initMemberObj();
          this.initUserObj(this.queryObj.userId);
          this.initSubscribeList();
          console.log("this.subscObj", this.subscObj);
        },
        initQueryData(queryData) {
          let keys = Object.keys(queryData);
          keys.forEach((key) => {
            this.queryObj[key] = queryData[key];
            // switch (key) {
            //   case "userId": {
            //     this.userObj.userId = queryData[key];
            //     break;
            //   }
            // }
          });
        },

        async initMemberObj() {
          // this.memberObj.list = this._cp(this.userObj);

          let userSheetDataArry = await gasFunc("getSheetUserList");
          userSheetDataArry = JSON.parse(userSheetDataArry);
          let { sheetName, dataLabelArry, sheetDataArry } = userSheetDataArry;
          this.memberObj.list = sheetDataArry.map((dataArry) => {
            let obj = {};
            dataLabelArry.forEach((key, key_i) => {
              obj[key] = dataArry[key_i];
            });
            return obj;
          });
        },
        initUserObj(userId) {
          let userObj = { userId: "Guest", name: "Guest" };
          if (userId) {
            let userObj_temp = this.memberObj.list.find((member) => {
              return member.userId === userId;
            });
            if (userObj_temp) userObj = userObj_temp;
          }
          this.userObj = userObj;
          this.memberObj.selectMemberObj = this._cp(userObj);
        },

        async initSubscribeList() {
          let dataForClientObj = await gasFunc("getSubscribeList");
          let { sheetName, dataLabelArry, sheetDataArry } = dataForClientObj;
          this.subscObj.database = sheetDataArry;
          this.subscObj.list = sheetDataArry.map((v) => {
            return v[0];
          });
          // let getData = (dataForClientObj) => {
          //   let { sheetName, dataLabelArry, sheetDataArry } = dataForClientObj;
          //   this.subscObj.database = sheetDataArry;
          //   this.subscObj.list = sheetDataArry.map((v) => {
          //     return v[0];
          //   });

          // this.subscObj.database = subscListArry;
          // if (subscListArry.length > 1) {
          //   this.subscObj.list = subscListArry
          //     .filter((v, i) => {
          //       return i !== 0;
          //     })
          //     .map((v) => {
          //       return v[0];
          //     });
          //   // this.subscObj.list.push(this.subscObj.listAddName);
          //   // this.subscObj.list.push(this.subscObj.listOtherName);
          // }

          // };
          // google.script.run.withSuccessHandler(getData).getSubscribeList();
        },
        initDeviceready() {
          this.deviceready = true;
          let tes = window.document.getElementById("app");
          tes.style.display = "block";
          console.log(tes, this);
        },

        ///////////////////
        //common
        //////////////////
        onUserChange({ userId, name }) {
          if (userId) {
            //userIdから変更
          } else if (name) {
            //use nameから変更
            let userObj_update = this.memberObj.list.find((member) => {
              return member.name === name;
            });
            console.log("userObj_update", userObj_update);
            // this.userObj=userObj_update
          } else {
            //none
          }

          console.log("onUserChange this.userObj", this.userObj);
        },

        ///////////////////
        //html call
        //////////////////
        findDisplayPageById(id) {
          return this.leftDrowerList.find((list) => {
            return list.id === id;
          });
        },
        isShowDisplayById(id) {
          // console.log(this.findDisplayPageById(id).isShow);
          return this.findDisplayPageById(id).isShow;
        },

        ///////////////////
        //helper
        //////////////////
        test2(item) {
          // console.log("2", this.queryObj);
          // console.log("2", this.userObj);
          // let tes = this.checkFormValidate(this.subscObj.refName);
          this.$store.dispatch("snackbarState/fire", { message: "fireee" });
          // this.loadingHandler({ isLoading: true, message: "lo-----" });
          // window.setTimeout(() => {
          //   this.loadingHandler({ isLoading: false });
          // }, 3000);
          console.log(this.userObj, this.queryObj);
          // console.log(tes);
          // console.log(this.subscObj);
          // console.log(this.subscObj.uploadFile);
        },

        snackFire({ message, timeout }) {
          this.$store.dispatch("snackbarState/fire", {
            message: message,
            timeout: timeout ? timeout : null,
          });
        },
        loadingHandler({ isLoading, message }) {
          let timeout = 10000;
          this.loadingObj.isLoading = isLoading;
          if (message) {
            this.loadingObj.message = message;
          } else this.loadingObj.message = null;

          if (isLoading) {
            window.setTimeout(() => {
              if (this.loadingObj.isLoading) {
                this.loadingObj.isLoading = false;
                this.snackFire({ message: "timeout error" });
              }
            }, timeout);
          }
        },

        formatDate(date, timeZone, format) {
          if (!format) var format = "yyyy/MM/dd HH:mm";
          format = format.replace(/yyyy/g, date.getFullYear());
          format = format.replace(
            /MM/g,
            ("0" + (date.getMonth() + 1)).slice(-2)
          );
          format = format.replace(/dd/g, ("0" + date.getDate()).slice(-2));
          format = format.replace(/HH/g, ("0" + date.getHours()).slice(-2));
          format = format.replace(/mm/g, ("0" + date.getMinutes()).slice(-2));
          format = format.replace(/ss/g, ("0" + date.getSeconds()).slice(-2));
          format = format.replace(
            /SSS/g,
            ("00" + date.getMilliseconds()).slice(-3)
          );
          return format;
        },

        _cp(obj) {
          /**
           * @param {Object,Array} obj ディープコピー
           * undefinedの場合もコピーできるように対応
           */
          if (Array.isArray(obj)) {
            let includeFunction = obj.find((item) => {
              return typeof item === "function";
            });
            if (includeFunction) {
              console.error("関数型の配列はコピーできません。");
              return false;
            } else {
              const currentState = window.history.state;
              window.history.replaceState(obj, null);

              const clone = window.history.state;
              window.history.replaceState(currentState, null);
              return clone;
            }
          } else {
            let keys = Object.keys(obj);
            let includeFunction = keys.find((key) => {
              return typeof obj[key] === "function";
            });

            if (includeFunction) {
              console.error("関数型のオブジェクトはコピーできません。");
              return false;
            } else {
              const currentState = window.history.state;
              window.history.replaceState(obj, null);

              const clone = window.history.state;
              window.history.replaceState(currentState, null);
              return clone;
            }
          }
        },
        ///////////////////
        //subscribe
        //////////////////
        fileInputBtnclick() {
          this.$refs.input.click();
        },
        async selectedFile() {
          this.helper.isLoading = true;

          const file = this.$refs.input.files[0];
          if (!file) {
            return;
          }
        },
        deleteSubscribeList(type, delete_i) {
          switch (type) {
            case "add": {
              this.subscObj.addIsShow[delete_i] = false;
              this.subscObj.addItemNum -= 1; //描画更新
              this.subscObj.addItemNum += 1;
              break;
            }
            case "other": {
              this.subscObj.otherIsShow[delete_i] = false;
              this.subscObj.otherItemNum -= 1; //描画更新
              this.subscObj.otherItemNum += 1;

              break;
            }
            default: {
              console.log(
                "error: type of deleteSubscribeList is only add or other"
              );
            }
          }
        },
        async getBase64(file) {
          return await new FileReaderEx().readAsDataURL(file);
        },
        async submitSubscribe() {
          let isValidate = this.checkFormValidate(this.subscObj.refName);
          let formatSubmitObj_subscribe = () => {
            //initer
            let {
              ATTRIBUTE_LIST,
              //listed
              selectItemArry,
              selectItemPriceArry,
              selectItemNumArry,
              selectPriceTypeArry,

              //追加情報
              addNameArry,
              addPriceArry,
              addNumArry,
              addPriceTypeArry,
              addIsShow,

              //その他情報
              otherNameArry,
              otherPriceArry,
              otherNumArry,
              otherPriceTypeArry,
              otherIsShow,
              memo,
              uploadFile,
            } = this.subscObj;
            let date = new Date();
            let dateUNIX = date.getTime();
            let imageName = this.formatDate(
              date,
              "JST",
              "yyyy_MM_dd_HHhmmminsssec"
            );
            let cnt_show = 0;
            let otherNameArry_sort = otherNameArry.slice();
            let otherPriceArry_sort = otherPriceArry.slice();
            let otherNumArry_sort = otherNumArry.slice();
            let otherPriceTypeArry_sort = otherPriceTypeArry.slice();
            otherIsShow.forEach((isShow, isShow_i) => {
              if (isShow === false) {
                otherNameArry_sort.splice(isShow_i - cnt_show, 1);
                otherPriceArry_sort.splice(isShow_i - cnt_show, 1);
                otherNumArry_sort.splice(isShow_i - cnt_show, 1);
                otherPriceTypeArry_sort.splice(isShow_i - cnt_show, 1);
                cnt_show++;
              }
            });
            cnt_show = 0;
            let addNameArry_sort = addNameArry.slice();
            let addPriceArry_sort = addPriceArry.slice();
            let addNumArry_sort = addNumArry.slice();
            let addPriceTypeArry_sort = addPriceTypeArry.slice();
            addIsShow.forEach((isShow, isShow_i) => {
              if (isShow === false) {
                addNameArry_sort.splice(isShow_i - cnt_show, 1);
                addPriceArry_sort.splice(isShow_i - cnt_show, 1);
                addNumArry_sort.splice(isShow_i - cnt_show, 1);
                addPriceTypeArry_sort.splice(isShow_i - cnt_show, 1);
                cnt_show++;
              }
            });

            let priceArry = selectItemPriceArry.map((price, price_i) => {
              if (
                selectPriceTypeArry[price_i] === this.subscObj.writePriceType[0]
              ) {
                //１個当たりの値段
                return price;
              } else if (
                selectPriceTypeArry[price_i] === this.subscObj.writePriceType[1]
              ) {
                //合計金額
                return price / selectItemNumArry[price_i];
              } else {
                console.error("selectPriceTypeArry does not exist type.");
                return price;
              }
            });
            let priceArry_add = addPriceArry_sort.map((price, price_i) => {
              if (
                addPriceTypeArry_sort[price_i] ===
                this.subscObj.writePriceType[0]
              ) {
                //１個当たりの値段
                return price;
              } else if (
                addPriceTypeArry_sort[price_i] ===
                this.subscObj.writePriceType[1]
              ) {
                //合計金額
                return price / addNumArry_sort[price_i];
              } else {
                console.error("addPriceTypeArry does not exist type.");
                return price;
              }
            });
            let priceArry_other = otherPriceArry_sort.map((price, price_i) => {
              if (
                otherPriceTypeArry_sort[price_i] ===
                this.subscObj.writePriceType[0]
              ) {
                //１個当たりの値段
                return price;
              } else if (
                otherPriceTypeArry_sort[price_i] ===
                this.subscObj.writePriceType[1]
              ) {
                //合計金額
                return price / otherNumArry_sort[price_i];
              } else {
                console.error("otherPriceTypeArry does not exist type.");
                return price;
              }
            });

            //inputer

            //itemArry=[date,attribute,name,price,num,memo,imageName]
            let itemArry = selectItemArry.map((selectItem, select_i) => {
              // let resItem = [
              //   date,
              //   ATTRIBUTE_LIST.LISTED,
              //   selectItem,
              //   priceArry[select_i],
              //   selectItemNumArry[select_i],
              //   memo,
              //   imageName,
              // ];
              let resItem = {
                createAt: dateUNIX,
                submitType: this.submitObj.TYPE.SUBSCRIBE,
                attribute: ATTRIBUTE_LIST.LISTED,
                buyUserId: this.memberObj.selectMemberObj.userId,
                buyUserName: this.memberObj.selectMemberObj.name,
                requestUserIdArry: [this.paymentObj.TYPE.SUBSCRIBE],
                name: selectItem,
                price: priceArry[select_i],
                sumPrice:
                  Number(priceArry[select_i]) *
                  Number(selectItemNumArry[select_i]),
                num: selectItemNumArry[select_i],
                memo: memo,
                imageName: imageName,
              };

              return this.formatSubmitObjtoArry(resItem);
            });
            let itemArry_add = addNameArry_sort.map((selectItem, select_i) => {
              // let resItem = [
              //   date,
              //   ATTRIBUTE_LIST.ADD,
              //   selectItem,
              //   priceArry_add[select_i],
              //   addNumArry[select_i],
              //   memo,
              //   imageName,
              // ];
              // let resItem = {
              //   date: dateUNIX,
              //   attribute: ATTRIBUTE_LIST.ADD,
              //   name: selectItem,
              //   price: priceArry_add[select_i],
              //   num: addNumArry[select_i],
              //   memo: memo,
              //   imageName: imageName,
              // };
              let resItem = {
                createAt: dateUNIX,
                submitType: this.submitObj.TYPE.SUBSCRIBE,
                attribute: ATTRIBUTE_LIST.ADD,
                buyUserId: this.memberObj.selectMemberObj.userId,
                buyUserName: this.memberObj.selectMemberObj.name,
                requestUserIdArry: [this.paymentObj.TYPE.SUBSCRIBE],
                date: dateUNIX,
                name: selectItem,
                price: priceArry_add[select_i],
                sumPrice:
                  Number(priceArry_add[select_i]) *
                  Number(addNumArry_sort[select_i]),
                num: addNumArry_sort[select_i],
                memo: memo,
                imageName: imageName,
              };

              return this.formatSubmitObjtoArry(resItem);
            });

            let itemArry_other = otherNameArry_sort.map(
              (selectItem, select_i) => {
                // let resItem = [
                //   date,
                //   ATTRIBUTE_LIST.OTHER,
                //   selectItem,
                //   priceArry_other[select_i],
                //   otherNumArry[select_i],
                //   memo,
                //   imageName,
                // ];
                // let resItem = {
                //   date: dateUNIX,
                //   attribute: ATTRIBUTE_LIST.OTHER,
                //   name: selectItem,
                //   price: priceArry_other[select_i],
                //   num: otherNumArry[select_i],
                //   memo: memo,
                //   imageName: imageName,
                // };
                let resItem = {
                  createAt: dateUNIX,
                  submitType: this.submitObj.TYPE.SUBSCRIBE,
                  attribute: ATTRIBUTE_LIST.OTHER,
                  buyUserId: this.memberObj.selectMemberObj.userId,
                  buyUserName: this.memberObj.selectMemberObj.name,
                  requestUserIdArry: [this.paymentObj.TYPE.SUBSCRIBE],

                  date: dateUNIX,
                  name: selectItem,
                  price: priceArry_other[select_i],
                  sumPrice:
                    Number(priceArry_other[select_i]) *
                    Number(otherNumArry_sort[select_i]),
                  num: otherNumArry_sort[select_i],
                  memo: memo,
                  imageName: imageName,
                };

                return this.formatSubmitObjtoArry(resItem);
              }
            );

            let formattedArry = itemArry
              .concat(itemArry_add)
              .concat(itemArry_other);

            return formattedArry;
          };
          if (isValidate) {
            this.loadingHandler({ isLoading: true, message: "送信中..." });

            let formatObj = formatSubmitObj_subscribe();
            let imageDataObj = {
              base64: await this.getBase64(this.subscObj.uploadFile),
              name: formatObj[0][13],
            };
            console.log(formatObj, imageDataObj);
            let success = () => {
              this.loadingHandler({ isLoading: false });
              this.snackFire({ message: "送信しました。" });
            };
            google.script.run
              .withSuccessHandler(success)
              .getPost_subscribe(formatObj, imageDataObj);
          } else {
            this.snackFire({
              message: "必要な情報を入力してください。",
            });
          }
        },

        ///////////////////
        //form
        //////////////////
        formatSubmitObjtoArry(obj) {
          // let template = {
          //   createAt,
          //   deleteAt,
          //   updateAt,
          //   attribute,
          //   buyUserId,
          //   requestUserIdArry,
          //   name,
          //   num,
          //   price,
          //   sumPrice,
          //   memo,
          //   imageName,
          // };
          let template = this._cp(this.submitObj.template);
          let keyArry = Object.keys(template);
          keyArry.forEach((key) => {
            if (!obj[key]) obj[key] = template[key];
          });
          let resArry = keyArry.map((key) => {
            if (typeof obj[key] !== "string") return String(obj[key]);
            return obj[key];
          });

          return resArry;
        },
        checkFormValidate(refName) {
          //v-formを用いた場合はこれでvalidateをチェックする
          //https://qiita.com/tekunikaruza_jp/items/0a68d86084d961d632ac
          return this.$refs[refName].validate();
        },
      },
    });
  }
  // var app = new Vue({
  //   el: "#app",
  //   data: {
  //     message: "Hello GAS!",
  //   },
  //   methods: {
  //     changeMessage: function () {
  //       this.message = "Hello JavaScript!";
  //     },
  //   },
  //});
</script>
